# inode

我们文件数据存储在硬盘上，硬盘最小的单位是扇区，一个扇区是 512 个字节。操作系统读取硬盘每次读取 4Kb。成为一个块。文件都存在块中。同时操作系统还会有一个区域记录文件的基本信息。这个基本信息成为文件的**元信息**。

## 一、inode 信息

元信息存储的位置成为 inode、中文名索引节点(index node)

inode 包括的文件信息如下

\* 文件的字节数

\* 文件拥有者的 User ID

\* 文件的 Group ID

\* 文件的读、写、执行权限

\* 文件的时间戳，共有三个：ctime 指 inode 上一次变动的时间，mtime 指文件内容上一次变动的时间，atime 指文件上一次打开的时间。

\* 链接数，即有多少文件名指向这个 inode

\* 文件数据 block 的位置

### 二、inode 大小

inode 也是存储在硬盘上。需要耗费硬盘空间。

每个 inode 节点的大小，一般是 128 字节或 256 字节。inode 节点的总数，在格式化时就给定，一般是每 1KB 或每 2KB 就设置一个 inode

可以使用

```shell
df -i
Filesystem      Inodes  IUsed   IFree IUse% Mounted on
/dev/vda1      2621440 262203 2359237   11% /
tmpfs           128788      2  128786    1% /dev/shm
```

### 三、inode id

每个 inode 都有一个 id。操作系统根据这个 id 识别文件

类似人的身份证号。我们通过识别身份证来区别人。人名只是一个称号。

打开文件，一般会有三步，

- 找到 inode 的 id
- 获取**inode**信息
- 找到文件数据所在的块。读取内容

### 四、目录文件

目录也是一种文件。linux 一切都是文件。目录文件的读权限（r）和写权限（w），都是针对目录文件本身。由于目录文件内只有文件名和 inode 号码

### 五、硬链接

一般情况，文件名和**inode** id 是一对 一的关系。但是 linux 下允许多个文件名指向一个**innode** id

可以用不同的文件名访问同样的内容；对文件内容进行修改，会影响到所有文件名。这种情况就被称为"硬链接"（hard link）。

![hard](hard.png)

```shell
ln 源文件 目标文件
```

运行上面这条命令以后，源文件与目标文件的 inode 号码相同，都指向同一个 inode。inode 信息中有一项叫做"链接数"，记录指向该 inode 的文件名总数，这时就会增加 1。

这个就像 PHP 的 zval 结构。zval 中含有一个 refcount 和一个 is_ref.当有引用的时候。会让 ref_count+1.is_ref 设置 1。

### 六、软链接

文件 A 和文件 B 的 inode 号码虽然不一样，但是文件 A 的内容是文件 B 的路径。读取文件 A 时，系统会自动将访问者导向文件 B。因此，无论打开哪一个文件，最终读取的都是文件 B。这时，文件 A 就称为文件 B 的"软链接"（soft link）或者"符号链接（symbolic link）。这种就是类似 windows 下的快捷方式。

```shell
ln -s 源文文件或目录 目标文件或目录
```
