# 互联网协议

## 应用层

- 规定应用程序的数据格式
- [HEAD(以太网标头) [HEAD(IP 标头) [HEAD(TCP 标头) DATA(应用层数据包)]]]

## 传输层(端口到端口的通信)

- 端口：
  - 0 到 65535(2^16)的整数
  - 进程使用网卡的编号
  - 通过 IP+mac 确定主机，只要确定主机+端口(套接字 socket)，就能进行程序间的通信
- UDP 协议：
  - 数据包中加入端口依赖的新协议
  - 数据包[HEAD(发送、接收 mac) [HEAD(发送、接收 ip) [HEAD(发送、接收端口) DATA]]]
  - 简单，可靠性差，不知道对方是否接受包
- TCP 协议：

  - 带有确认机制的 UDP 协议
  - 过程复杂，实现困难，消耗资源

    ```
    tcp/ip connect: tcp/ip的三次握手
    syn握手信号
    ------------->
    syn/ack确认字符
    client  <-------------  server
    ack确认包
    -------------->
    ```

## 网络层(主机到主机的通信)

### IP 协议

#### ipv4

- 32 个二进制位表示，由网络部分和主机部分构成，
- 子网掩码: 网络部分都为 1，主机部分都为 0，目的判断 ip 的网络部分，如 255.255.255.0(11111111.11111111.11111111.00000000)
- IP 数据包：标头 Head+数据 Data,放进以太网数据包的 Data 部分[HEAD [HEAD DATA]]
- IP 数据包的传递：
  - 非同一网络：无法获得 mac 地址,发送数据到网关，网关处理
  - 同一网络：mac 地址填写 FF:FF:FF:FF:FF:FF:FF，广播数据，对比 ip，不符合丢包

## 链接层

- 定义数据包(帧 Frame)
  - 标头(Head):数据包的一些说明项, 如发送者、接收者、数据类型
  - 数据(Data):数据包的具体内容
  - 数据包:[HEAD DATA]
- 定义网卡和网卡唯一的 mac 地址
  - 以太网规定接入网络的所有终端都应该具有网卡接口，数据包必须是从一个网卡的 mac 地址到另一网卡接口的 mac 地址
  - mac 全球唯一，16 位 16 位进制组成，前 6 厂商编号，后 6 网卡流水号
- 广播发送数据
  - 向本网络内的所有设备发送数据包，对比接收者 mac 地址，不是丢包，是接受

## 实体层：

终端(pc，phone，pad...)的物理连接(光缆，电缆，路由...)，负责传递 0 和 1 信号
