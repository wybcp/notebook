# 变量

## 及时销毁变量

数组、对象和 GLOBAL 变量在 PHP 中特别占内存的，这个由于 PHP 的底层的 zend 引擎引起的。

一般来说，PHP 数组的内存利用率只有 `1/10`。

也就是说，一个在 C 语言里面 100M 内存的数组，在 PHP 里面就要 1G。

特别是，在 PHP 作为后台服务器的系统中，经常会出现内存耗费太大的问题。

## 使用`$_SERVER` 变量

如果你需要得到脚本执行的时间，`$_SERVER['REQUSET_TIME']`优于`time()`。

一个是现成就可以直接用，一个还需要函数得出的结果。

## 方法里建立局部变量

在类的方法里建立局部变量速度最快，几乎和在方法里调用局部变量一样快。

## 局部变量比全局变量快

由于局部变量是存在栈中的。

当一个函数占用的栈空间不是很大的时候，这部分内存很有可能全部命中 cache，CPU 访问的效率是很高的。

相反，如果一个函数同时使用全局变量和局部变量，当这两段地址相差较大时，cpu cache 需要来回切换，效率会下降。

## 局部变量而不是对象属性

建立一个对象属性（类里面的变量，例如：`$this->prop++`）比局部变量要慢`3`倍。

## 提前声明局部变量

建立一个未声明的局部变量，要比建立一个已经定义过的局部变量慢`9-10`倍。

## 谨慎声明全局变量

声明一个未被任何一个函数使用过的全局变量，也会使性能降低。

这和声明相同数量的局部变量一样，PHP 可能去检查这个全局变量是否存在。

## 使用`++$i`递增

当执行变量`$i`的递增或递减时，`$i++`会比`++$i`慢一些。

这种差异是 PHP 特有的，并不适用于其他语言，所以请不要修改你的 C 或 Java 代码，并指望它们能立即变快，没用的。

`++$i`更快是因为它只需要 3 条指令(opcodes)，`$i++`则需要 4 条指令。

后置递增实际上会产生一个临时变量，这个临时变量随后被递增。

而前置递增直接在原值上递增。

这是最优化处理的一种，正如 Zend 的 PHP 优化器所作的那样。

牢记，这个优化处理不失为一个好主意，因为不是所有的指令优化器都会做同样的优化处理。

## 不要随便复制变量

有时候为了使 PHP 代码更加整洁，一些 PHP 新手（包括我）会把预定义好的变量，复制到一个名字更简短的变量中。

其实这样做的结果是增加了一倍的内存消耗，只会使程序更加慢。

试想一下，在下面的例子中，如果用户恶意插入`512KB` 字节的文字，就会导致 1MB 的内存被消耗！

```php
// 不好的实践
$description = $_POST['description'];
echo $description;

// 好的实践
 echo $_POST['description'];
```

## 循环内部不要声明变量

尤其是大变量，这好像不只是 PHP 里面要注意的问题吧？

## 一定要对变量进行初始化

这里的“初始化”指的是“声明”。

当需要没有初始化的变量，PHP 解释器会自动创建一个变量，但依靠这个特性来编程并不是一个好主意。

这会造成程序的粗糙，或者使代码变得另人迷惑。

因为你需要探寻这个变量是从哪里开始被创建的。

另外，对一个没有初始化的变量进行递增操作要比初始化过的来得慢。

所以对变量进行初始化会是个不错的主意。
