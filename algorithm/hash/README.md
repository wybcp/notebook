# [哈希算法](https://time.geekbang.org/column/article/65312)

将任意长度的二进制值串映射为固定长度的二进制值串，这个映射的规则就是哈希算法，而通过原始数据映射之后得到的二进制值串就是哈希值。

- 从哈希值不能反向推导出原始数据，单向哈希算法；
- 对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也大不相同；
- 散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小；
- 哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值。

## 常用哈希算法

### SHA

SHA（Secure Hash Algorithm，安全散列算法）

### MD5

MD5（MD5 Message-Digest Algorithm，MD5 消息摘要算法
MD5 的哈希值是 128 位的 Bit 长度

### DES（Data Encryption Standard，数据加密标准）

### AES（Advanced Encryption Standard，高级加密标准）

## 应用

### 安全加密

### 唯一标识

图库，图片

哈希算法可以对大数据做信息摘要，通过一个较短的二进制编码来表示很大的数据。

### 数据校验

BT 下载文件校验：通过哈希算法，对 100 个文件块分别取哈希值，并且保存在种子文件中。哈希算法有一个特点，对数据很敏感。只要文件块的内容有一丁点儿的改变，最后计算出的哈希值就会完全不同。所以，当文件块下载完成之后，我们可以通过相同的哈希算法，对下载好的文件块逐一求哈希值，然后跟种子文件中保存的哈希值比对。如果不同，说明这个文件块不完整或者被篡改了，需要再重新从其他宿主机器上下载这个文件块。

### 散列函数

散列函数对于散列算法计算得到的值，是否能反向解密并不关心。散列函数中用到的散列算法，更加关注散列后的值是否能平均分布，也就是，一组数据是否能均匀地散列在各个槽中。除此之外，散列函数执行的快慢，也会影响散列表的性能，所以，散列函数用的散列算法一般都比较简单，比较追求效率。

### 负载均衡

会话粘滞（session sticky）的负载均衡算法：需要在同一个客户端上，在一次会话中的所有请求都路由到同一个服务器上。

通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号。 这样，我们就可以把同一个 IP 过来的所有请求，都路由到同一个后端服务器上。

### 数据分片

通过哈希算法对数据取哈希值，然后对机器个数取模，这个最终值就是应该存储的缓存机器编号。

如何统计“搜索关键词”出现的次数？

    假如我们有 1T 的日志文件，这里面记录了用户的搜索关键词，我们想要快速统计出每个关键词被搜索的次数，该怎么做呢？

    这个问题有两个难点，第一个是搜索日志很大，没办法放到一台机器的内存中。第二个难点是，如果只用一台机器来处理这么巨大的数据，处理时间会很长。

    针对这两个难点，可以先对数据进行分片，然后采用多台机器处理的方法，来提高处理速度。具体的思路是这样的：为了提高处理的速度，我们用 n 台机器并行处理。我们从搜索记录的日志文件中，依次读出每个搜索关键词，并且通过哈希函数计算哈希值，然后再跟 n 取模，最终得到的值，就是应该被分配到的机器编号。

    这样，哈希值相同的搜索关键词就被分配到了同一个机器上。也就是说，同一个搜索关键词会被分配到同一个机器上。每个机器会分别计算关键词出现的次数，最后合并起来就是最终的结果。

    实际上，这里的处理过程也是 MapReduce 的基本设计思想。

### 分布式存储

[一致性哈希算法](https://www.sohu.com/a/158141377_479559)

假设有 k 个机器，数据的哈希值的范围是 [0, MAX]。将整个范围划分成 m 个小区间（m 远大于 k），每个机器负责 m/k 个小区间。当有新机器加入的时候，就将某几个小区间的数据，从原来的机器中搬移到新的机器中。这样，既不用全部重新哈希、搬移数据，也保持了各个机器上数据数量的均衡。

### MurmurHash 算法

MurmurHash 算法提供了两种长度的哈希值，一种是 32bits，一种是 128bits。将 10 进制的哈希值，转化成更高进制的哈希值，这样哈希值就变短了。在网址 URL 中，常用的合法字符有 0 ～ 9、a ～ z、A ～ Z 这样 62 个字符。为了让哈希值表示起来尽可能短，我们可以将 10 进制的哈希值转化成 62 进制。

一般情况下，MySQL 数据库会保存短网址跟原始网址之间的对应关系，以便后续用户在访问短网址的时候，可以根据对应关系，查找到原始网址,短网址字段添加 B+ 树索引。

解决 hash 冲突：给原始网址拼接一串特殊字符，比如“[DUPLICATED]”，然后跟再重新计算哈希值，返回时，先将特殊字符去掉，然后再将不包含特殊字符的原始网址返回给浏览器。

不需要考虑反向解密的难度，只需要关心哈希算法的计算速度和冲突概率。

[短网址服务](https://time.geekbang.org/column/article/72414)，把原始的长网址转化成短网址。
